---
order: 2
icon: creative
title: 데이터 모델
category: IT서적
tag:
  - chapter 2
---

> The limits of my language mean the limits of my world.

## 개요

대부분의 애플리케이션은 하나의 데이터 모델을 다른 데이터 모델 위에 계층을 둬서 만든다. 각 계층의 핵심적인 문제는 다음 하위 계층 관점에서 데이터 모델을 표현하는 방법이다.

- 애플리케이션 개발자는 현실을 보고 객체나 데이터 구조 또한 이러한 데이터 구조를 다루는 API를 모델링한다.
- 데이터 구조를 저장할 때는 JSON, 관계형 데이터베이스 테이블 혹은 그래프 모델 같은 범용 데이터 모델(general data model)로 표현한다.
- 데이터베이스 소프트웨어를 개발하는 엔지니어는 general-purpose data를 메모리나 디스크 또는 네트워크 상위 바이트 단위로 표현하는 방법을 결정한다.
- 더 낮은 관점에서 보면 하드웨어 엔지니어는 전류, 빛의 파동 자기장 등의 관점에서 바이트를 표현한다.

보다시피 각 계층은 명확한 데이터 모델을 제공해 하위 계층의 복잡성을 숨긴다. 이 추상화는 다른 그룹에서 일을 하는 사람들이 (예를 들어 데이터 베이스 엔지니어와 애플리케이션 개발자) 효율적으로 함께 일 할 수 있게끔 한다.

데이터 모델은 소프트웨어가 어떻게 작성됐는지 뿐만 아니라 해결하려는 문제를 어떻게 생각해야 하는지, **그 위에서 소프트웨어가 할 수 있는 일과 할 수 없는 일에 지대한 영향을 주므로 애플리케이션에 적합한 데이터 모델을 선택하는 작업은 상당히 중요하다.**

이 장에서는 다양한 범용 데이터 모델(general data model) 중에서도 관계형 모델, 문서 모델, 그래프 기반 데이터 모델에 중점을 두고 살펴본다.
각 데이터 모델을 특징, 사용하는 이유와 얻을 수 있는 이점을 명확히 알아야 우리가 만들려는 애플리케이션에 맞춰서 선택할 수 있다.

## 관계형 모델

- 오늘날 가장 잘 알려진 모델은 관계형 모델을 기반으로 한 SQL이다.
- 데이터(SQL에서 테이블이라고 불린다) 관계(relation)로 구성되고 각 관계는 순서 없는 튜플(tuple 혹은 row)의 모음이다.
- 관계형 데이터베이스의 근원은 1960-1970년대 메인프레임에서 수행된 비즈니스 데이터 처리에 있다.
  - 트랜잭션 처리(은행 거래, 항공 예약, 창고 재고 보관)
  - 일괄처리(송장 작성, 급여 지불, 보고)
- 당시 다른 데이터베이스를 사용하는 애플리케이션 개발자는 데이터베이스의 내부 데이터 표현에 대해 많이 고민해야 했지만 관계형 모델의 목표는 정리된 인터페이스 뒤로 구현 세부 사항을 숨기는 것이다.

## NoSQL

Not Only SQL로 해석된다.
NoSQL DB를 채택한 데는 다음과 같은 원동력이 있다.

- 대규모 데이터셋이나 매우 높은 쓰기 처리량 달성에 대해 RDB보다 더 뛰어난 확장성이 필요(Scalability)
- 오픈소스에 대한 선호도 확산
- 관계형 모델에서 지원하지 않는 특성화된 질의 동작
- 관계형 스키마의 제한에 대한 불만, 더 동적이고 풍부해진 데이터 모델에 대한 바람
- NoSQL의 대표적인 모델
  - 문서 DB : 문서와 문서 간 관계가 거의 없는 경우를 대상으로 한다.
  - 그래프 DB : 모든 자료가 잠재적으로 관련 있는 경우를 대상으로 한다.

## NoSQL : 문서모델

누군가의 이력서 프로필을 예시로 든다면. 일반적인 이력서는 이력이 하나 이상이며 학력과 연락처 정보도 다양할 수 있다. 사용자와 항목은 일대다(one-to-many) 관계이다. 이런 관계를 전통적인 방법으로 RDB를 설계하면 정규화 표현으로 직위, 학위, 학력, 연락처 정보를 개별 테이블에 저장하고 외래 키를 이용해 user 테이블을 참조할 수 있다.
그러나 이력서는 모든 내용을 갖추고 있는 문서 이기 때문에 JSON이 표현에 적합하다. 몽고 DB 카우치 DB 등의 문서 지향 데이터 베이스에서 Json 데이터 모델을 지원한다.

- JSON 표현은 multi-table 스키마보다 더 나은 지역성(locality)을 갖는다.
- 다중 질의 수행하거나 다중 조인이 필요 없다. 모든 관련 정보가 한 곳에 있어 질의 하나로 충분하다.
- 일대다 관계는 의미상 데이터 트리 구조와 같다.

:::info 다대일과 다대다 관계
만약 이력서에서 지역에 대한 정보가 들어간다면 이 경우는 보통 문자로 받지 않고 region_id처럼 ID로 주어진다. 이렇게 id가 주어지는 이유는 아래와 같은 장점이 있다.

- 일관된 스타일과 철자
- 모호함 회피(서울, 서울시, 서울특별시와 같은 단어를 정제하여 사용)
- 갱신의 편의성
- 현지화 지원, 표준 목록을 현지화하여 지역과 업계를 사이트를 보는 사람의 언어로 표시
- 더 나은 검색 제공(워싱턴 주에 있는 자선가)

중복의 문제: Id를 사용하면 정보를 한 곳에만 저장하고 해당 Id를 사용하면 되지만, 텍스트로 저장하면 모든 레코드에 중복이 발생한다. 만약 정보가 중복되어있으면 변경사항 발생 시 모든 중복항목을 변경해야 하므로 쓰기 오버헤드와 불일치 위험이 있다.

이처럼 **중복된 데이터를 정규화하려면 다대일(many-to-one) 관계가 필요하지만 문서 모델에는 적합하지 않다. 조인에 대한 지원이 약하기 때문이다.**
:::

## NoSQL : 그래프 모델

관계형 모델 또한 다대다 관계를 다루지만, 데이터 간 연결이 더 복잡해지면 그래프로 데이터를 모델링하는 쪽이 더 자연스러울 수 있다. 모든 데이터가 잠재적으로 관련 있는 데이터를 다루는 애플리케이션에 적합하다.

그래프의 구성 요소는 정점(vertex)과 간선(edge) 두 객체로 이루어져 있다.

일반적인 그래프 모델링의 예

- 소셜 그래프

  - 정점: 사람
  - 간선: 사람들이 서로 알고 있음

* 웹 그래프

  - 정점: 웹 페이지
  - 간선: 다른 페이지에 대한 HTML 링크

- 도로나 철도 네트워크
  - 정점: 교차로
  - 간선: 도로/철로 선 등

그래프는 위의 예시와 그래프의 정점이 같이 모두 같은 유형을 나타내지는 않는다. 다른 여러 유형의 정점과 간선을 단일 그래프로 나타내기도 한다.

- ex. 페이스북
  - 정점: 사람, 장소, 이벤트, 체크인, 코멘트
  - 간선: 어떤 사람들이 서로 친구인가?
  - 간선: 어떤 사람이 어떤 위치에서 체크인했는가?
  - 간선: 어떤 사람이 어떤 포스트에 좋아요를 눌렀는가?
  - 간선: 어떤 사람이 어떤 포스트에 코멘트를 작성했는가?
  - 간선: 어떤 사람이 이벤트에 참여했는가?

## 각 데이터 모델의 비교

문서 데이터 모델을 선호하는 주요 이유는 스키마 유연성, 지역성에 기인한 더 나은 성능 때문이고, 일부 애플리케이션의 경우 애플리케이션에서 사용하는 데이터 구조와 더 가깝기 때문이다(일대다 관계) 관계형 모델은 조인, 다대일, 다대다 관계를 더 잘 지원한다.

만약 애플리케이션의 데이터가 이력서와 같이 문서와 비슷한 구조 즉 일대다 트리 관계로 한 번에 전체 트리를 적재할 수 있는 경우라면 문서 모델을 이용하는 것이 좋다.
이 경우 관계형 모델을 사용할 경우 테이블을 분리하게 되면서 불필요하게 복잡한 애플리케이션 코드를 발생시키게 된다.

문서 데이터 베이스는 내 중첩 항목을 바로 참조할 수 없다는 문제를 가지고 있지만 너무 깊게 중첩되지 않으면 일반적으로 문제가 되지 않는다.

문서 데이터 베이스의 미흡한 조인 조건은 문제일 수도 아닐 수도 있다. 어떤 애플리케이션에서 사용하느냐의 문제인데 예를 들어 어떤 시점에 발생한 이벤트를 기록하는 분석 애플리케이션은 다대다 관계가 결코 필요하지 않다. 문서 데이터 베이스를 사용하는 것이 적합하다.

하지만 애플리케이션에서 다대다 관계를 사용한다면 문서 모델보다 관계형 데이터베이스가 낫다.

**애플리케이션 내에서 조인을 대체할 다중 요청을 만들어 낼 수 있기는 하지만 복잡성이 애플리케이션으로 이동될 뿐 아니라 데이터 베이스 내 특화된 코드로 수행되는 조인보다 느리다.**

일반적으로 어떤 데이터 모델이 애플리케이션 코드를 더 간단하게 만들 수 있는가에 대한 답은 없다.
데이터 항목 간에 존재하는 관계 유형에 따라 다르다.
상호연결이 많은 데이터의 경우 문서 모델은 곤란하고 관계형 모델은 무난하며 그래프 모델은 매우 자연스럽다.

## 오늘의 공부 한마디

- 정말 많은 내용이 있었지만 소화할 수 있을 만큼만 기록했다 나중에 다시 보면 더 많이 이해할 수 있겠지
