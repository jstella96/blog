---
order: 3
icon: creative
title: 실행 컨텍스트
category:
  - JavaScript
editLink: false
---

::: tip GOAL
Q. 자바스크립트 실행컨텍스트란?  
Q. 메모리 저장 관점에서 두가지 타입을 구분하는 차이는?
:::
해당페이지는 2022년 3월 노션에서 마이그레이션 되었습니다.

## 실행 컨텍스트(Execution Context)

Context : 문맥/맥락/환경

- 코드를 실행하는데에 필요한 코드의 배경이 되는 조건/환경정보
- 동일한 조건/환경을 지니는 코드 뭉치를 실행할 때 필요한 조건/환경정보

**[동일한 조건,환경가지는 경우 4가지]**

1. 전역공간 => 자바 스크립스 시작 되는 순간에 생성 하나의 **함수공간**
2. 함수  
3. eval => 위험한 명령어라 논외
4. module => module import 되는 순간에 생성되는 하나의 **함수공간**

결국 자바스크립트의 동일한 조건의 코드뭉치는 **함수**라고 볼 수 있고 자바스크립트는 함수에 의해서만 컨텍스트를 구별할 수 있다. 즉, **실행 컨텍스트란 함수를 실행할 때 필요한 조건,환경정보를 담은 객체이다.**

:::info 주의 
if/for/switch/while 문등은 ES6에서 블록스코프 개념이 추가 되면서 let, const 를 위해 별개의 독립된 공간의 역할은 하고 있으나 별개의 실행 컨텍스트를 생성하지는 않는다.
:::

## 코드 분석1

```js
var a = 1;
function outer() {
  console.log(a); // 1번째 출력
  function inner() {
    console.log(a); // 2번째 출력
    var a = 3;
  }
  inner();
  console.log(a); // 3번째 출력
}
outer();
console.log(a); // 4번째 출력
```

실행 순서


1. 전역 컨텍스트가 먼저 열리고, 전역공간을 순차적으로 실행한다
2. 선언부분을 먼전 실행 후 outer() 명령을 만난다.
3. outer 함수의 실행 컨텍스트가 열리면서, 내부의 명령을 순차적으로 실행하게 된다.
4. console.log(a) 출력 `1번째 출력`
5. inner()명령을 만나 호출되면서 inner() 실행컨텍스트가 열린다.
6. console.log(a) 출력 `2번째 출력`
7. inner 호출 종료된다.
8. console.log(a) 출력 `3번째 출력`
9. outer 함수의 실행 컨텍스트 종료 된다.
10. console.log(a) 출력 `4번째 출력`
11. 전역 컨텍스트 종료


즉 컨텍스트 `전역 열림-> 아우터 열림-> inner 열림 -> inner 닫힘 -> outter 닫힘 -> 전역 닫힘 `
이렇게 먼저 들어왔던게 마지막에 빠지는 개념을 스택이라하며 코드 스택에 관여하는 스택을 콜스택이라 한다.  

:::info 콜스택
콜스택 : 현재 어떤 함수가 동작중인지, 다음에 어떤 함수가 호출될 예정인지 등을 제어하는 자료구조 이다.

콜스택이 실행되는 동안 가장 위에 쌓여있는 컨텍스트를 실행하며, 모든 컨텍스트가 빠지면 더이상 실행할 내용이 없다고 판단해 종료된다.
:::



## 실행컨텍스트 내부 살펴보기

실행컨텍스트에는3가지 환경 정보가 담긴다.

1. VariableEnvironment
2. LexicalEnvironment
3. ThisBinding

- VariableEnvironment, LexicalEnvironment : 이 두개엔 현재 환경과 관련된 식별자 정보들이 담긴다.
- VariableEnvironment : 는 오직 식별자 정보를 수집하는 용도, 변수 값 변화 반영x
- LexicalEnvironment : 각 식별자의 데이터 추적, 변수 값 변화 반영 o

둘의 차이는 변수 값 변화 실시간 반영 여부에 있다. 계속 변경사항을 추적하고 있는 LexicalEnvironment만 위주로 살펴본다.

### LexicalEnvironment

어휘적/사전적 환경 :  실행컨텍스트를 구성하는 환경 정보들을 모아 사전처럼 구성한 객체


```
ex)실행컨텍스트 A 환경사전
내부 식별자 a : 현재 값은 undefined 이다
내부 식별자 b : 현재 값은 20이다.
외부 정보: D를 참조한다.
```

### LexicalEnvironment의 하위 정보

- environmentRecord:
  - 현재 문맥의 식별자 정보(hoisting)
  - 실행 컨텍스트가 최초 실행될때 가장먼저 하는 일, 현재 컨텍스트의 식별자 정보를 수집에서 environmentRecord에 담는 과정 -> Hoisting호이스팅, 끌어올리다. -> 식별자 정보를 실행 컨텍스트의 맨 위로 끌어올린다.
  - 변수, 함수실행문등 현재 컨텍스트에서 선언되어 있는 식별자 들이 무엇이 있느냐라는 정보를 코드 순서대로 수집을 하다 보니까 호이스팅 한거랑 같은 개념이됨 environmentRecord 에 정보수집은 실제 일어난 일이고, 코드가 위로 올라간 개념(Hoisting)은 이해하기 쉬운 허구의 개념.
- outerEnviromentReference (외부환경참조):
  - 현재 문맥과 관련있는 외부 식별자 정보, 외부 LexicalEnvironment를 참조.-> scope chain 에 관여 한다. (변수의 유효범위에 관여 한다.)

:::info  스코프체인(cope chain)은 무엇인가?

inner에서는 outer 변수에는 접근 가능하나 반대는 안된다. 외부로는 나갈 수 있으나 자기보다 안쪽으로는 들어갈 수 없다. inner에서 어떤 변수를 찾으라고 하면 먼저 environmentRecord에서 찾고 없으면 outerEnviromentReference여기서 찾는다.    
그럼 바로 아래 컨텍스트의LexicalEnvironment 안의 environmentRecord에서 찾고 거기에도 해당 변수가 없다면 outerEnviromentReference를 타고 또 다시 아래 컨텍스트의 environmentRecord를 찾는다.  
**즉 가장 가까운 자기자신부터 점점 멀리있는 스코프로 찾아 나가는 것이 스코프 체인이다.**
스코프 체인의 과정에서 가장 먼저 찾은 값만 접근이 가능하다 이 개념이 shadowing(가린다)라고 한다.
:::
## 코드분석2

위 코드를 컨텍스트 관점에서 다시 분석해보면

```{1,6,10,14,17,21}
==<전역 컨텍스트 , GLOBAL Execution Context 활성화>==
변수 a 선언
함수 outer 선언
변수 a에 1할당
outer 함수 호출 -> outer Execution Context 활성화
  ==< outer 컨텍스트 >==
  inner 선언
  outer context에서 a 탐색 -> global context에서 a 탐색 -> 1 출력
  inner 함수 호출 -> inner Execution Context 활성화
    ==< inner 컨텍스트>==
    변수 a 선언 // 현재 undefined
    inner context에서 a 탐색 -> undefined 출력
    1변수 a에 3 할당
    ==< inner 컨텍스트 종료, 콜스택에서 사라짐>==
  outer context에서 a 탐색 -> global context에서 a 탐색 -> 1 출력
  ==< outter 컨텍스트 종료, 콜스택에서 사라짐>==
global context에서 a 탐색 -> 1 출력
==< 전역 컨텍스트, global context 종료>==
```

## 정리

실행컨텍스트(Execution Context) : 함수를 실행할 때 필요한 환경정보를 담은 객체

1. VariableEnvironment : 최초식별자 값 들고 있으나 변하지 않음
2. LexicalEnvironment : 실행컨텍스트 실행 내용에 따라 변수 값 바뀔 때 변경 사항 트랙킹  
   -environmentRecord : 현재문맥의 식별자(hoisting)  
   -outerEnviromentReference: 외부식별자(scope chain)

3. ThisBinding

## Reference

[코어 자바스크립트(인프런)](https://www.inflearn.com/course/%ED%95%B5%EC%8B%AC%EA%B0%9C%EB%85%90-javascript-flow/dashboard)
