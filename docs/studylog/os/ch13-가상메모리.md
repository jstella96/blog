---
order: 13
icon: creative
title: 가상메모리
category:
  - OS
tag:
  - 운영체제
editLink: false
---

::: tip GOAL
Q. 가상메모리의 개념과 사용시 장점은 무엇인가요?  
Q. 페이지 폴트와 페이지 대치란 무엇인가요?  
Q. 스레싱 문제란 무엇인가요?  
:::
해당페이지는 2022년 3월 노션에서 마이그레이션 되었습니다.

## 가상 메모리 개념

- 배경
  앞선 메모리 관리는 **실행중인 코드는 반드시 물리 메모리에 있어야 했다**
  오류코드나, 많은 공간을 점유하는 자료구조, 옵션이나 자주 사용되지 않는 기능들도 항상 메모리에 적재되어있어야 할까?  
   => 프로그램을 일부분만 메모리에 올려놓고 실행하면 어떨까?

- 장점

  - 프로그램이 물리 메모리 크기에 더 이상 제약 받지 않게 됨
  - 더 많은 프로그램을 동시에 수행할 수 있음
  - 프로그램을 메모리에 올리고 스왑하는데 필요한 입출력 횟수가 줄어들기 때문에 프로그램들이 보다 빨리 실행됨
  - 페이지 공유를 통해 둘 이상의 프로세스에서 파일과 메모리를 공유할 수 있음
    - 라이브러리가 존재하는 물리 메모리 페이지들은 모든 프로세스에게 공유되고 있음
    - 한 프로세스가 다른 프로세스와 공유할 수 있는 메모리 영역을 생성할 수 있음

- 특징
  - 실제의 물리 메모리 개념과 사용자의 논리 메모리 개념을 분리
  - 작은 메모리를 가지고도 얼마든지 큰 가상 주소 공간을 프로그래머에게 제공할 수 있음
  - 한 프로세스의 가상 주소 공간은 그 프로세스가 메모리에 저장되는 논리적인 모습(view)
    - 동적 메모리 할당에 사용되므로 힙이 메모리에서 위쪽으로 증가하도록 허용
    - 연속적인 함수 호출을 위해 스택이 메모리에서 아래쪽으로 커지도록 허용

## 요구 페이징

가장 일반적인 가상 메모리 체계로 스와핑을 사용하는 페이징 시스템과 비슷하다. 프로그램을 실행하려고 프로그램의 일부만 메인 메모리에 적재한다. 순차적으로 작성되어 있는 프로그램의 모듈을 처리할 때 다른 부분은 실행하지 않는다는 특징을 이용한다. 메모리를 효율적으로 사용할 수 있지만 메인 메모리와 디스크 간의 과도한 페이지 교체로 오버헤드를 증가시켜 시스템의 성능을 떨어뜨린다는 단점이 있다.

- **필요할 때만 페이지 적재한다.** 요구 페이징 가상 메모리를 사용하면, 프로그램 실행 중 요청이
  있을 때만 페이지가 로드 된다.
- 액세스 되지 않은 페이지는 물리 메모리에 적재되지 않는다.
- 스왑 인, 스왑 아웃을 관리하는 페이저
- 메모리에 존재하는 페이지와 디스크에 존재하는 페이지를 구별하기
  위해 어떤 형태의 하드웨어 지원이 필요하다.

**유효-무효 비트(valid-invalid bit)**

- ‘valid’라면, 관련 페이지가 메모리에 존재함
- ‘invalid’라면, 페이지가 유효하지 않거나, 유효하지만 현재 메모리에 존재하지 않고 보조 저장소에 있다는 의미

## 페이지 폴트(Page fault) : 무효로 표시된 페이지에 대한 액세스

**페이지 폴트 처리절차**

1. 유효한 메모리 접근인지 , 무효한 메모리 접근인지 확인을 위해 프로세스 내부 테이블을 확인
2. 유효하지 않은 경우 프로세스를 종료. 유효하지만 아직 해당 페이지를 가져오지 않은 경우
   페이지를 입력
3. 비어있는 프레임 검색
4. 원하는 페이지를 새로 할당된 프레임으로 읽어 들이기 위해 2차 저장작업을 예약
5. 저장소 읽기가 완료되면 프로세스와 함께 유지되는 내부 테이블과 페이지 테이블을 수정하여
   페이지가 현재 메모리에 있음을 나타냄
6. 트랩에 의해 중단된 명령을 재개. 프로세스는 메모리에 있었던 것처럼 페이지 액세스 가능

## 페이지 대치(교체)

페이지 대치는 페이지 부재가 발생하면 메인 메모리에 있으면서 사용하지 않는 페이지를 디스크로 내보내고 새로운 페이지로 바꾸는 과정이다. 유효-무효 비트를 확인하여 필요시 페이지 교체한다. 내보낼 페이지를 고를 때는 시스템의 효율성에 영향을 주므로 LRU, FIFO 적용해서 교체방안, 교체 알고리즘을 고민해야 한다.

## 대치 알고리즘

- 선입선출 대치 알고리즘

- 최적 페이지 대치 알고리즘

- 최근 최소 사용 대치 알고리즘

- 최근 최소 사용 근접 알고리즘

## 프레임 할당 알고리즘

페이지 부재(저장하지 않은 페이지 사용하려고 할 때 나타나는 현상)를 줄이려면 프레임을 할당하는 방법도 매우 중요하다.

- 균일 프레임 할당 알고리즘 : 각 프로세스에 똑같이 프레임을 m/n 개씩 할당하는 방법
- 비례 프레임 할당 알고리즘 : 사용 가능한 메모리를 각 프로세스의 크기에 비례하여 할당하는 방법

## 쓰기 시 복사란

- 쓰기 시 복사 : 페이지를 공유(부모,자식) write 할 때만 복사본을 생성하여 별도 참조
- 부모 및 자식 프로세스가 처음에 동일한 페이지를 공유하도록 허용하여
  작동
- 프로세스 중 하나가 공유 페이지에 쓰는 경우 공유 페이지의 복사본이
  생성
- 예) 자식 프로세스가 페이지 수정을 시도한다면,
  - 운영 체제는 이 페이지의 복사본을 생성하여 자식 프로세스의 주소
    공간에 매핑
  - 자식 프로세스는 부모 프로세스에 속한 페이지가 아닌 복사된 페이지를
    수정

## 스레싱 문제

- 스레싱: 페이지를 교체하고 반복해서 페이징 작업이 발생하는 상황. (자기가 할 일보다 교체에 시간을 많이 쓰는 상황, 비효율
- 스레싱제한 : 지역교체 알고리즘, 우선순위 교체 알고리즘
- 스레싱 방지 : 작업 집합 모델, 페이지 폴트 빈도

## 지역성

프로세스가 어느 실행 단계 동안 메모리의 정보를 균일하게 엑세스 하는 것이 아니라 선호하는 특정 페이지만 집중적으로 참조하는 현상이다.

- 시간 지역성
- 공간지역성

## 작업 집합 모델

프로세스가 많이 참조하는 페이지 집합을 메모리 공간에 계속 상주시켜 빈번한 페이지 대치 현상을 줄이도록 프로그램 수행과정을 지역성으로 설명하는 모델이다.

- 작업 집합크기가 작고 페이지 프레임 수가 적으면, 페이지 부재 비율이 높아 스래싱 현상을 일으킬 수 있다.
- 작업 집합 크기가 크고 페이지 프레임 수가 많으면 프로세스의 실제 작업 페이지와 다른 페이지 까지 메모리를 차지하여 메모리 낭비와 다중 프로그래밍 정도를 감소 시킬수있다.

## 페이지 부재비율

페이지 부재 비율 (PFF, Page Fault Frequency)은 스래싱을 예방하는 직접적인 엑세스 방법 으로, 페이지 환경에서 프로세스의 실행을 측정하는 기준이 된다. 페이지 부재 비율이 상한 값을 넘으면 프로세스에 다른 프레임을 더 할당한다. 하한 값보다 낮으면 프레임을 회수하여 스래싱을 방지하면서 페이지 부재비율을 측정 조절하여서 작업 집합 모델보다 오베헤드가 적다.

## 시스템 성능을 향상시키는 기타 이슈

가상 메모리의 페이지 방법에서 할당 알고리즘과 대치 알고리즘 적재 정책이외에 시스템 성능에 영향을 미치는 첫 번째 요소는 프레임 할당 기준으로 페이지 대치 범위를 모든 프로세스에 적적용하는 전역 대치와 프로세스를 개별적으로 제한 하는 지역 대치가 있다. 두 번째 요소는 예상되는 모든 페이지를 사전에 한꺼번에 메모리로 가져오는 프리페이징(prepaging)방법이다. 또 페이지 테이블의 크기와 페이지 테이블 구조(역 페이지 테이블의 구조, 변환 우선참조 버퍼) 등도 고려해야 한다.
