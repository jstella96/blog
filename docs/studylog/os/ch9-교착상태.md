---
order: 9
icon: creative
title: 교착상태
category:
  - OS
tag:
  - 운영체제
editLink: false
---

::: tip GOAL
Q. 교착 상태의 개념과 발생원인은?  
Q. 교착 상태의 해결방법은(예방,회피,탐지-회복 각 관점에서)?
:::
해당페이지는 2022년 3월 노션에서 마이그레이션 되었습니다.

## 교착 상태 개념

- 프로세스가 서로가 wait()하여 signal()연산 실행 불가할때, 그로인해 무한 대기 현상이 발생한 상태
- 다중 프로그래밍 시스템에서는 프로세스가 결코 일어나지 않을 사건(event)을 기다리는 상태.
- 둘 이상의 프로세스가 다른 프로세스가 점유하고 잇는 자원을 서로 기다리는 상태.
- 한 시스템에서 다음 4가지 조건이 동시성립시 교착상태가 발생 할 수 있다. (상호배제, 점유와 대기, 비선점조건, 순환대기)

## 교착상태 발생조건

위 4가지 조건을 하나씩 살펴보면 다음과 같은 의미를 가진다.

1. 상호 배제(Mutual exclusion): 두 프로세스가 동시에 같은 자원에 접근을 할 수 없다. 사용 중인 자원을 다른 프로세스가 사용하려면 요청한 자원이 해제될 때 까지 대기해야 한다.
2. 점유하며 대기(hold and wait): 프로세스가 최소한 하나의 자원을 점유하면서 다른 프로세스에 의해 점유된 자원을 추가로 흭득하기 위해 대기를 하는 프로세스가 있어야한다.
3. 비선점(No preemption): 자원들을 선점 할 수 없다, 자원이 강제적으로 해제 될 수 없고 점유하고 있는 프로세스가 태스크를 종료한 후에만 해제된다.
4. 순환대기(Circular wait): 자원들이 cyclic하게 점유한 자원들을 대기하는 상태

## 교착상태의 해결 방법

교착 상태를 해결하는 방법은 크게 다음 3가지로 나눌 수 있다.

1. 교착 상태가 발생하지 않도록 예방(prevention)하는 방법
2. 교착 상태의 발생 가능성을 배제하지 않고 이를 적절히 회피(avoidance)하는 방법
3. 교착 상태를 허용하되 교착상태를 탐지(detection)하여 다시 회복하는 방법

### 예방(prevention): 교착상태가 발생하지 않고록 예방하는 방법

1. 자원의 상호배제 조건 방지

- 동시공유 가능한 리소스를 설정한다. ex) 읽기 전용 파일  
  그러나 자원의 공유자체가 불가능한 자원이 있다 ex) 파일 쓰기, 프린터. 이 같은 경우는 배타적인 접근만 허용해야 하는데 하나 이상의 프로세스에 쓰기 권한이 동시에 있으면 교착상태가 발생 할 수 있다.
- 자원을 비공유한다(여기서 비공유란 전용 자원느낌)

2. 점유와 대기 조건 방지

- 프로세스가 작업을 수행하기 전에 필요한 자원을 모두 요청하고 허용될 때 까지 작업을 보류한다.(최대 자원 할당/대기 조건 성립x)
- 또 다른 방법은 프로세스가 자원을 전혀 갖고 있지 않을 때만 자원을 요청 할 수 있다.  
  점유하지 않을 때에 다른 프로세스가 자원을 요구하도록 하는 방법이다.

복사를 위한 한 작업을 처리 할 때 DVD드라이브, 디스크파일, 프린터, 테이프드라이버 이 4개의 자원이 필요하다고 하자.  
첫번째 방법은 프로세스를 시작할 때 필요한 자원을 모두 요청하고 시작한다. 마지막 단계에 필요한 테이프 드라이버를 전체 실행시간동안 점유한다.  
두번째 방법의 경우는 처음에는 DVD드라이브와 디스크 파일을 요청한다. 그 후 두개의 자원을 해제 하고 다시 디스크 파일과 프린터를 요청한다. 그 후 또 다시 두개의 자원을 해제 한 후 재요청한다.
이 방법은 데이터가 디스크에 그대로 남아 있다고 확신 할 수 있을 때만 사용 가능하다.

문제점:  
 자원 과다 사용으로 인한 비효율성(사용되지 않으면서 오랫동안 할당 되어있다.), 프로세스의 요구 자원을 파악하는 비용, 자원에 대한 내용을 저장 및 복원하기 위한 비용, 기아상태, 무한 대기 등

3. 비선점 조건 방지

- 프로세스가 일부 자원을 점유하고 있으면서 다른 자원을 요청 했을 때 즉시 할당할 수 없으면 프로세스가 현재 점유한 모든 자원을 해제한 후 대기한다.(할당된 자원에 선점권이 없어야한다.)
- 기존 자원을 사용중이던 프로세스가 작업 내용을 잃을 수 있다. 작업의 상태를 쉽게 저장, 복구 할 수 있을 때 혹은 자원요청이 빈번하게 발생하지 않을 때만 좋은 방법이다.

4. 순환 대기 조건 방지

- 모든 자원에 일련의 순서를 부여하고 각 프로세스가 순서에따라 자원을 요청할 수 있게 한다.
- 자원을 요청하는 작업이 실제로 자원을 사용하기 훨씬 전부터 오랫동안 자원을 할당받은 상태로 있어야 하므로 자원 낭비가 있다.

결론 : 교착상태 방지는 교착상태의 발생조건 중 최소한 하나라도 성립하지 않도록 자원요청을 제한한다.
=> 결국은 장치의 효율성과 시스템 처리량을 떨어트리게 된다.

### 회피(avoidance) : 교착상태가 발생할 가능성을 인정하고(예방하지 않고) 교착상태가 발생하려고 할 때 회피하는 방법

**1. 프로세스의 시작 중단 : 프로세스의 요구가 교착상태를 발생시킬 수 있다면 프로세스 시작을 중단한다.**

- 교착상태 회피 알고리즘은 시스템이 순환 대기 조건이 발생하지 않도록 자원할당 상태를 검사한다.
- 다양한 교착상태 회피 알고리즘 중에서 가장 단순하고 유용한 알고리즘 중 하나는 각 프로세스가 필요한 자원의 최대치 (할당 가능한 자원 수)를 선언하는 것이다.
- 시스템이 현재 수행 중인 모든 프로세스의 최대 자원 요청량과 새로운 프로세스의 최대 요청량을 합한 자원 요청량을 수용할 수 있으면 새로운 프로세스를 수용한다.
- 그러나 프로세스에 최대요청량이 필요하다는 최악의 상황이므로 바람직하지는 않다.

안전상태 : 모든 사용자가 일정기간 안에 작업을 끝낼 수 있도록 운영체제가 할 수 있음  
불안정상태 : 그렇지 못하다. 교착상태가 발생할 가능성이 있다.

상태가 안정하다면 운영체제는 불안정상태와 교착상태를 예방할 수 있다.
즉 초기 시스템은 안정상태이다. 프로세스가 현재 사용가능한 자원을 요청할때마다 시스템은 자원을 즉시 할당할 수 있는지 또는 프로세스가 대기해야하는지를 결정한다. 자원을 할당한 후 에도
시스템이 항상 안정 상태에 있을 때만 할당을 허용하면 된다

**2. 자원 할당 거부 : 프로세스가 요청한 자원을 할당했을 때 교착상태가 발생할 수 있다면 요청한 자원을 할당하지 않는다 (은행가 알고리즘)**

- 프로세스가 자원을 요청할 때 마다 실행한다.
- 상태를 안전상태(safe state) / 불안전상태(unsafe state)로 분류
- 안전상태를 유지할 수 있는 요청만을 수락, 불안전상태의 경우 추후 만족하는 상태로 바뀔 때까지 계속 거절
- 은행가 알고리즘 구현을 위해 필요한 자료구조  
  현재점유량 (Allocation) :현재 프로세스 별 할당 자원의 수  
  최대요구자원 (Max):프로세스 별 최대 자원의 요구  
  현재여유자원(Available):사용 가능한 자원의 수  
  필요량(Need): 프로세스 별 남아있는 자원의 수, Need[i][j] = Max[i][j] – Allocation[i][j]

### 탐지(detection) : 교착상태를 탐지하여 다시 회복하는 방법

- 교착상태 예방이나 회피 알고리즘을 사용하지 않는 다면 교착상태 탐지, 교착상태 회복 알고리즘이 필요하다.
- 교착상태 탐지 알고리즘의 경우 요청할 때 마다 교착상태 알고리즘 호출을 한다면 연산시간 부담이 있다. 특정시간마다 탐 혹은 CPU 이용률이 일정기준 이하로 떨어질때마다 등으로 호출빈도를 줄이는 방법이 있다.
- 교착상태에서 회복하는 한 가지 방법은 순환대기를 탈피하는 것인데, 프로세스를 한개 이상 중단하는 방법과 교착상태의 프로세스들에서 자원을 선점하는 방법으로 다시 구분할 수 있다.
